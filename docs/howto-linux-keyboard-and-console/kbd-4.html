<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<title>The Linux keyboard and console HOWTO: Resetting your terminal</title>
	</head>
	<body class="container">
		<nav>
			<ul class="pagination">
				<li class="page-item"><a class="page-link" href="kbd-3.html">Previous</a></li>
				<li class="page-item"><a class="page-link" href="kbd-5.html">Next</a></li>
			</ul>
		</nav>

		<div class="page-header">
			<h2><a name="s4">Resetting your terminal</a></h2>
		</div>

		<p>There is garbage on the screen, or all your keystrokes are echoed
		as line drawing characters. What to do?</p>

		<p>Many programs will redraw the screen when Ctrl-L is typed. This might
		help when there is some modem noise or broadcast message on your screen.
		The command <code>clear</code> will clear the screen.</p>

		<p>The command <code>reset</code> will reset the console driver. This helps when
		the screen is full of funny graphic characters, and also if it is
		reduced to the bottom line. If you don't have this command, or if it
		does something else, make your own by putting the following two lines
		in an executable file <code>reset</code> in your PATH:
		<pre>
        #!/bin/sh
        echo -e \\033c
</pre>

		that is, you want to send the two characters ESC c to the console.</p>

		<p>Why is it that the display sometimes gets confused and gives you
		a 24-line or 1-line screen, instead of the usual 25 lines?
		Well, the main culprit is the use of <code>TERM=vt100</code> (or some other
		entry with 24 lines) instead of <code>TERM=linux</code> when logged in remotely.
		If this happens on <code>/dev/tty2</code> then typing
		<pre>
        % cat > /dev/tty2
        ^[c
        ^D
</pre>

		on some other VT (where 4 symbols are typed to <code>cat</code>: ESC, c, ENTER,
		Ctrl-D) and refreshing the screen on <code>/dev/tty2</code>
		(perhaps using Ctrl-L) will fix things. Of course the permanent fix
		is to use the right termcap or terminfo entry.
		A command that only changes the number of lines is
		<pre>
        % echo -e "\033[1;25r"
</pre>
		</p>

		<p>Why is it that you sometimes get a lot of line-drawing characters,
		e.g., after catting a binary to the screen?
		Well, there are various character set changing escape sequences,
		and by accident your binary might contain some of these.
		The ESC c is a general reset, a cure for all, but if you know
		precisely what went wrong you can repair it without resetting
		other console attributes. For example, after
		<pre>
        % cat
        ^N
        ^D
</pre>

		your shell prompt will be all line-drawing characters.
		Now do (typing blindly)
<pre>
        % cat
        ^O
        ^D
</pre>

		and all is well again. (Three symbols typed to each <code>cat</code>:
		Ctrl-N (or Ctrl-O), ENTER, Ctrl-D.) To understand what is happening,
		see `The console character sets' below.</p>

		<p>If you loaded some strange font, and want to return to the default,
		<pre>
        % setfont
</pre>

		will do (provided you stored the default font in the default place).
		If this default font does not contain an embedded Unicode map (and
		gives the wrong symbols for accented characters), then say
		<pre>
        % loadunimap
</pre>

		For example, if I do
		<pre>
        % loadkeys de-latin1
</pre>

		then I have a German keyboard, and the key left of the Enter key
		gives me a-umlaut. This works, because the a-umlaut occurs
		on the CP437 code page and the kernel Unicode map is initialized
		to CP437, and my video card has a CP437 font built-in.
		If I now load an ISO 8859-1 font with
		<pre>
        % setfont iso01.f16
</pre>

		then everything still works, because <code>setfont</code> invalidates the kernel
		Unicode map (if there is no Unicode map attached to the font), and without
		map the kernel goes directly to the font, and that is precisely correct
		for an ISO 8859-1 system with <code>iso01.f16</code> font.
		But going back to the previous font with
		<pre>
        % setfont
</pre>

		gives capital Sigma's instead of a-umlaut - all accented letters
		are mixed up because also this font has no embedded Unicode map. After
		<pre>
        % loadunimap
</pre>

		which loads the default Unicode map (which is right for the default
		font) all works correctly again. Usually <code>loadunimap</code> is not
		invoked directly, but via <code>setfont</code>. Thus, the previous two
		commands may be replaced by
		<pre>
        % setfont -u def
</pre>

		These days most fonts have embedded Unicode maps (often this is
		indicated by the extension <code>.psfu</code>), and none of this nonsense
		is needed anymore.</p>

		<p>On very old terminals output involving tabs may require a delay,
		and you have to say
		<pre>
        % stty tab3
</pre>

		(see stty(1)).

		<p>You can change the video mode using <code>resizecons</code> or
		<code>SVGATextMode</code>. Or by rebooting and having "vga=ask"
		in the LILO configuration file.</p>

		<p>This usually settles the output side.</p>

		<p>On the input side there are many things that might be wrong. If <code>X</code> or
		<code>DOOM</code> or some other program using raw mode crashed, your keyboard may
		still be in raw (or mediumraw) mode, and you must give the command
		<pre>
        % kbd_mode -a
</pre>

		or
		<pre>
        % kbd_mode -u
</pre>

		to get back to normal 8-bit or Unicode mode again. Of course in this
		situation it may be difficult to give commands.
		(See "How to get out of raw mode" below.)</p>

		<p>If you loaded a bad keymap, then
		<pre>
        % loadkeys -d
</pre>

		loads the default map again, but it may well be difficult to type `-'!
		An alternative is
		<pre>
        % loadkeys defkeymap
</pre>

		Sometimes even the letters are garbled. It is useful to know that there
		are four main types of keyboards: QWERTY, QWERTZ, AZERTY and DVORAK.
		The first three are named after the first six letter keys, and roughly
		represent the English, German and French speaking countries.
		Compared to QWERTY, the QWERTZ map interchanges Y and Z.
		Compared to QWERTY, the AZERTY map interchanges Q and A, W and Z, and has
		its M right of the L, at the semicolon position.
		DVORAK has an entirely different letter ordering.
		There are two types of Turkish keyboard. The so-called `Q'-keyboard
		has a QWERTY layout, while the `F'-keyboard has an entirely
		different layout, let us say fgGIod, where G stands for Gbreve
		and I for dotlessi.</p>

		<div class="page-header">
			<h3><a name="ss4.1">Keyboard hardware reset</a></h3>
		</div>

		<p>Things may be wrong on a lower level than Linux knows about.
		There are at least two distinct lower levels (keyboard and keyboard controller)
		where one can give the command "keyboard disable" to the keyboard hardware.
		Keyboards can often be programmed to use one out of three
		different sets of scancodes.</p>

		<p>However, I do not know of cases where this turned out to be
		a problem.</p>

		<p>Some keyboards have a remapping capability built in.
		Stormy Henderson (<code>stormy@Ghost.Net</code>) writes:
		`If it's your keyboard accidently being reprogrammed, you can
		(on a Gateway AnyKey keyboard) press control-alt-suspend_macro
		to reset the keys to normal.'</p>

		<hr/>
		<nav>
			<ul class="pagination">
				<li class="page-item"><a class="page-link" href="kbd-3.html">Previous</a></li>
				<li class="page-item"><a class="page-link" href="kbd-5.html">Next</a></li>
			</ul>
		</nav>
	</body>
</html>
