<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<title>The Linux keyboard and console HOWTO: XFree86</title>
	</head>
	<body class="container">
		<nav>
			<ul class="pagination">
				<li class="page-item"><a class="page-link" href="kbd-12.html">Previous</a></li>
				<li class="page-item"><a class="page-link" href="kbd-14.html">Next</a></li>
			</ul>
		</nav>

		<div class="page-header">
			<h2><a name="s13">XFree86</a></h2>
		</div>

		<p>This FAQ/HOWTO is about the Linux keyboard and console, not about X,
		which substitutes its own handling. However, it seems useful to
		document some of the Linux keyboard and console related properties
		of X.</p>

		<p>First of all, when X is started (say using <code>startx</code> or <code>xinit</code>)
		it opens the first unused console, unless the desired console has been
		indicated explicitly, as in <code>xinit -- vt12</code>.
		Note that this will fail when there is no device file <code>/dev/tty12</code>,
		but that it will not fail when the indicated console was in use already.
		When X finishes, it will return to the original console.
		While it is running one can use Ctrl-Alt-Fn to switch to VTn.</p>

		<p>The XFree86 keymap mechanism is much poorer than the Linux mechanism.
		For each keycode there are at most 4 symbols defined, namely for the
		4 keymaps plain, shift, mod, mod+shift. What is the modifier mod?
		It is the one designated by the symbol <code>Mode_switch</code>.
		For example, the command <code>xmodmap keys.dk</code>, where the file
		<code>keys.dk</code> contains
		<pre>
keycode 64 = Mode_switch
keycode 113 = Mode_switch
keycode 38 = a A aring Aring
keycode 26 = e E ae AE
keycode 32 = o O oslash Ooblique
</pre>

		will make both Alt keys into mod keys, so that Alt+a gives å (a-ring), etc.
		(Note the illogical naming of oslash and Ooblique.)
		Such an <code>xmodmap</code> command can be placed in the <code>.xinitrc</code>
		shell script that is executed by default when X is started.</p>

		<div class="page-header">
			<h3><a name="ss13.1">What precisely does XFree86-2.1 do when it initializes its keymap?</a></h3>
		</div>

		<p>Since version 2.1, XFree86 will initialize its keymap from the Linux keymap,
		as far as possible. However, Linux had 16 entries per key (one for each
		combination of the Shift, AltGr, Ctrl, Alt modifiers) and presently has
		256 entries per key, while X has 4 entries per key (one for each combination
		of Shift, Mod), so some information is necessarily lost.</p>

		<p>First <code>X</code> reads the <code>Xconfig</code> file, where definitions of the LeftAlt, RightAlt,
		RightCtl, ScrollLock keys as Meta, ModeShift, Compose, ModeLock or ScrollLock
		might be found - see X386keybd(1), later XFree86kbd(1).</p>

		<p>For Mod the LeftAlt key is taken, unless RightCtl was defined as ModeShift or
		ModeLock, in which case RightCtl is taken, or RightAlt was so defined, in which
		case RightAlt is taken.
		This determines how the 4 XFree86 meanings of a key are selected from the 16
		Linux meanings.
		Note that Linux today does not distinguish by default between the two Ctrl keys
		or between the two Shift keys. <code>X</code> does distinguish.</p>

		<p>Now the kernel keymap is read and the usually obvious corresponding X
		bindings are made. The bindings for the "action keys" Show_Memory, Show_State,
		Show_Registers, Last_Console, Console_n, Scroll_Backward, Scroll_Forward,
		Caps_On and Boot are ignored, as are the dead diacriticals, and the locks
		(except for ShiftLock), and the "ASCII-x" keys.</p>

		<p>Next, the definitions in the <code>Xconfig</code> file are used. (Thus, a definition
		of Compose in <code>Xconfig</code> will override its value as found in the Linux
		keymap.)</p>

		<p>What happens to the strings associated with the function keys? Nothing,
		X does not have such a concept. (But it is possible to define strings
		for function keys in <code>xterm</code> - note however that the window manager gets the
		keys first.)</p>

		<p>I don't know how to convince <code>xterm</code> that it should use the X keymap
		when Alt is pressed; it seems just to look at its resource <code>eightBitInput</code>,
		and depending on whether that is true or false either set the high order bit
		of the character, or generate an additional Escape character
		(just like setmetamode(1) does for the console).</p>

		<hr/>
		<nav>
			<ul class="pagination">
				<li class="page-item"><a class="page-link" href="kbd-12.html">Previous</a></li>
				<li class="page-item"><a class="page-link" href="kbd-14.html">Next</a></li>
			</ul>
		</nav>
	</body>
</html>
